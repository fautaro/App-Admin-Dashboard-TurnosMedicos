@{
    ViewData["Title"] = "Agregar nuevo usuario";
}
@using BusinessEntity.Response
@model ResponseGetDatosAgregarUsuario



<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='utf-8' />
    <link href="~/css/sb-admin-2.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.10.0/css/bootstrap-datepicker.min.css" integrity="sha512-34s5cpvaNG3BknEWSuOncX28vz97bRI59UnVtEEpFX536A7BtZSJHsDyFoCl8S7Dt2TPzcrCEoHBGeM4SUBDBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="~/lib/jquery-timepicker/jquery.timepicker.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>

    <div id="app">
        <!-- Content Row -->
        <div class="row">
            <!-- Area Chart -->
            <div class="col-xl-12 col-lg-12">
                <div class="card shadow mb-4">
                    @if (Model != null)
                    {
                        @if (Model.Success == false)
                        {
                            <div class="row">
                                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">No hay datos para su usuario. Por favor, comuníquese con el administrador.</h6>
                                </div>
                            </div>
                        }
                        else
                        {
                            <!-- Card Header - Dropdown -->
                            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                <h6 class="m-0 font-weight-bold text-primary">Configurar usuario</h6>
                            </div>
                            <div class="card-body">
                                <div class="container">
                                    <ul class="nav nav-tabs" id="secciones">
                                        <li class="nav-item">
                                            <a class="nav-link active" id="seccion-profesional" data-bs-toggle="tab" href="#profesional">Profesional</a>
                                        </li>
                                    </ul>

                                    <div class="tab-content">
                                        <div class="tab-pane fade show active" id="profesional">
                                            <div class="tab-pane fade show active" id="profesional">
                                                <div class="mb-3">
                                                    <label for="nombre" class="form-label">Nombre</label>
                                                    <input type="text" class="form-control" id="nombre" name="nombre" value="" v-model="nombre">
                                                </div>
                                                <div class="mb-3">
                                                    <label for="apellido" class="form-label">Apellido</label>
                                                    <input type="text" class="form-control" id="apellido" name="apellido" value="" v-model="apellido">
                                                </div>
                                                <div class="mb-3">
                                                    <label for="profesion" class="form-label">Profesión</label>
                                                    <select class="form-select" id="profesion" name="profesion">
                                                        <option value="">Profesion</option>
                                                        @foreach (var profesion in Model.Profesion)
                                                        {
                                                            <option value="@profesion.Profesion_Id">@profesion.Nombre</option>
                                                        }
                                                    </select>
                                                </div>
                                            </div>

                                        </div>

                                        <div class="tab-pane fade" id="horarios">
                                            <table class="table table-responsive">
                                                <thead>
                                                    <tr>
                                                        <th>Horario</th>
                                                        <th>Acciones</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                </tbody>
                                            </table>
                                            <button class="btn btn-primary">Agregar nuevo horario</button>

                                        </div>
                                        <div class="tab-pane fade" id="paginaPublica">
                                            <div style="margin-top:20px">
                                                <div class="mb-3">
                                                    <label for="titulo" class="form-label">Título de pagina pública</label>
                                                    <input type="text" class="form-control" id="titulo" name="titulo" value="" v-model="titulo">
                                                </div>
                                                <div class="mb-3">
                                                    <label for="alias" class="form-label">Alias</label>
                                                    <input type="text" class="form-control" id="alias" name="alias" value="" v-model="alias">
                                                </div>
                                                <div class="mb-3">
                                                    <label for="descripcion" class="form-label">Descripción de pagina pública</label>
                                                    <textarea class="form-control" id="descripcion" name="descripcion" rows="4" v-model="descripcion"></textarea>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="intervalo" class="form-label">Intervalo</label>
                                                    <input type="number" class="form-control" id="intervalo" name="intervalo" value="" v-model="intervalo">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <button class="btn btn-primary" v-on:click="guardarCambios()">Guardar Cambios</button>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <div class="row">
                            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                <h6 class="m-0 font-weight-bold text-primary">No hay datos para su usuario. Por favor, comuníquese con el administrador.</h6>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
    <script src="~/js/vue.global.js"></script>
    <script>
        const app = Vue.createApp({

            data() {
                return {
                    //Valores seleccionados por el usuario
                    profesion_id: 0,
                    nombre: "",
                    apellido: "",
                    //Valores Pag Publica
                    titulo: "",
                    descripcion: "",
                    alias: "",
                    intervalo: "",
                    //Notificador
                    notifier: new AWN({
                        durations: {
                            global: 2000,
                            info: null
                        }
                    })


                }
            },
            methods: {
                guardarCambios() {
                    if (this.profesion_id == "" || this.profesion_id == 0 || this.nombre == "" || this.apellido == "" || this.titulo == "" || this.descripcion == "" || this.alias == "" || this.intervalo == "") {
                        this.notifier.info('Por favor, complete todos los campos');
                            else {
                        this.guardarUsuario();

                    }
                },
                guardarUsuario() {
                    let obj = {
                        profesion_Id: '@Model.Usuario_Id',
                        nombre: this.nombre,
                        apellido: this.apellido,
                        titulo: this.titulo,
                        descripcion: this.descripcion,
                        alias: this.alias,
                        intervalo: this.intervalo

                    };

                    let message = `<table class="table">
                                <tr>
                                    <th>Profesión ID</th>
                                    <td>${obj.profesion_Id}</td>
                                </tr>
                                <tr>
                                    <th>Nombre</th>
                                    <td>${obj.nombre}</td>
                                </tr>
                                <tr>
                                    <th>Apellido</th>
                                    <td>${obj.apellido}</td>
                                </tr>
                                <tr>
                                    <th>Título</th>
                                    <td>${obj.titulo}</td>
                                </tr>
                                <tr>
                                    <th>Descripción</th>
                                    <td>${obj.descripcion}</td>
                                </tr>
                                <tr>
                                    <th>Alias</th>
                                    <td>${obj.alias}</td>
                                </tr>
                                <tr>
                                    <th>Intervalo</th>
                                    <td>${obj.intervalo}</td>
                                </tr>
                                    </table>`

                    Swal.fire({
                        title: 'Guardar datos de usuario',
                        text: `¿Está seguro de guardar los siguientes datos?`,
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Confirmar',
                        cancelButtonText: 'Atrás',
                        html: message,
                    }).then((result) => {
                        if (result.isConfirmed) {
                            Swal.fire({
                                title: "Guardando datos de nuevo usuario",
                            })
                            Swal.showLoading()
                            fetch(`/Admin/GuardarDatosNuevoUsuario`, {
                                method: "POST",
                                body: JSON.stringify(obj),
                                headers: {
                                    "Content-Type": "application/json"
                                },
                            }).then(response => response.json())
                                .then(success => {
                                    Swal.hideLoading()
                                    if (success) {
                                        Swal.fire(
                                            'Datos de nuevo usuario guardados',
                                            'El nuevo usuario ha sido configurado correctamente.',
                                            'success'
                                        ).then((result) => {
                                            window.location.href = '/Home';

                                        });
                                    } else {
                                        Swal.fire(
                                            'Datos de nuevo usuario no guardado',
                                            'No ha sido posible guardar los datos del nuevo usuario.',
                                            'info'
                                        )
                                    }
                                })
                                .catch(error => {
                                    Swal.hideLoading()
                                    Swal.fire(
                                        'Datos de nuevo usuario no guardado',
                                        'No ha sido posible guardar los datos del nuevo usuario.',
                                        'info'
                                    ).then((result) => {
                                        window.location.reload();
                                    });
                                });
                        }
                    })
                }
            }
        });

        app.mount('#app');
    </script>
</body>

</html>